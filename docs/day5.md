# Day 5 - [자동화] Python으로 구현하는 Docker 셀프 힐링

1. 오늘 작업의 핵심 목표
- **"잠들지 않는 감시자"** 만들기: 사람이 일일이 `docker ps`를 치지 않아도, 스크립트가 10초마다 컨테이너 상태를 확인하도록 구현.

- **MTTR(Mean Time To Recovery) 최소화**: 장애 발생 시 엔지니어가 인지하기도 전에 코드가 즉시 서비스를 재시작하여 중단 시간을 극정으로 단축.

2. 주요 구현 로직

- **기술 스택**: Python3.9, Docker SDK(Subprocess), EC2

- **핵심 모듈**: `subprocess`
    - 파이썬 내에서 쉘 명령어를 실행하고 그 결과값을 변수로 받아오는 가교 역할.
    - `docker inspect`명령어를 통해 컨테이너의 `Running` 상태가 `true`인지 `false`인지 판별.
- **진입점 제어**: `if __name__ == "__main__"`:을 사용하여 스크립트 실행 시 모니터링 루프가 안전하게 시작되도록 설정.

3. 트러블슈팅

- 문제1: `__name__ == "__main"`오타 및 공백 문제로 인해 스크립트가 실행되지 않음.
    - 해결: 파이썬의 특수 변수 명명 규칙을 재확인하고 진입점 설정을 정확히 수정.

- 문제2: `TypeError: universal_newline ...` 에러 발생.
    - 원인: 파이썬 버전 및 `subprocess` 모듈의 매개변수 명칭 오타(`universal_newlines`에서 `s` 누락).

    - 교훈: OS 및 언어 라이브러리의 정확한 문법 확인이 자동화의 안정성을 결정한다는 것을 깨달음.

4. 최종 결과
- `docker stop ops-target`으로 장애를 강제 연출했을 때, 약 10초 이내에 파이썬 스크립트가 이를 감지하고 `docker restart`를 수행하여 서비스를 정상 복구함.